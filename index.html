<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rule Engine UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-gray-100">
    <div class="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-md">
        <h1 id="rule-engine-ui" class="text-2xl font-bold mb-6">Rule Engine UI</h1>

        <h2 id="create-rule" class="text-xl font-semibold mb-4">Create Rule</h2>
        <div class="mb-6">
            <p class="mb-2">Rule Format:</p>
            <ul class="list-disc list-inside mb-2">
                <li>(attribute operator value) AND/OR (attribute operator value)</li>
                <li>Operators: =, >, <</li>
                <li>Use parentheses to group conditions</li>
                <li>Strings should be in single quotes</li>
            </ul>
            <p class="mb-2">Example: (age > 30 AND department = 'Sales') OR (salary < 50000)</p>
            <input type="text" id="ruleInput" class="w-full p-2 border rounded" placeholder="Enter your rule here">
            <button onclick="createRule()" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded">Create Rule</button>
        </div>

        <h2 id="existing-rules" class="text-xl font-semibold mb-4">Existing Rules</h2>
        <div id="rulesList" class="mb-6">
            <!-- Existing rules will be populated here -->
        </div>
        <button onclick="deleteAllRules()" class="bg-red-500 text-white px-4 py-2 rounded">Delete All Rules</button>

        <h2 id="evaluate-rule" class="text-xl font-semibold mb-4 mt-6">Evaluate Rule</h2>
        <div class="mb-6">
            <p class="mb-2">Enter JSON data matching the attributes in your rules.</p>
            <p class="mb-2">Example: {"age": 35, "department": "Sales", "salary": 60000}</p>
            <textarea id="dataInput" class="w-full p-2 border rounded" rows="4" placeholder="Enter your JSON data here"></textarea>
            <button onclick="evaluateRule()" class="mt-2 bg-green-500 text-white px-4 py-2 rounded">Evaluate Rule</button>
        </div>

        <div id="result" class="mt-4 p-4 bg-gray-200 rounded hidden"></div>
        <div id="error" class="mt-4 p-4 bg-red-200 text-red-700 rounded hidden"></div>
    </div>

    <script>
        function createRule() {
            const ruleString = document.getElementById('ruleInput').value;
            axios.post('/create_rule', { rule: ruleString })
                .then(response => {
                    alert('Rule created successfully');
                    fetchRules();
                })
                .catch(error => {
                    document.getElementById('error').innerText = `Error: ${error.response.data.error}`;
                    document.getElementById('error').classList.remove('hidden');
                });
        }

        function evaluateRule() {
            const data = JSON.parse(document.getElementById('dataInput').value);
            axios.post('/evaluate_rule', { data: data })
                .then(response => {
                    document.getElementById('result').innerText = `Result: ${response.data.result}`;
                    document.getElementById('result').classList.remove('hidden');
                })
                .catch(error => {
                    document.getElementById('error').innerText = `Error: ${error.response.data.error}`;
                    document.getElementById('error').classList.remove('hidden');
                });
        }

        function fetchRules() {
            axios.get('/get_rules')
                .then(response => {
                    const rulesList = document.getElementById('rulesList');
                    rulesList.innerHTML = '';
                    response.data.forEach(rule => {
                        const ruleElement = document.createElement('div');
                        ruleElement.className = 'mb-2 p-2 bg-gray-100 rounded flex justify-between items-center';
                        ruleElement.innerHTML = `
                            <span>${rule.rule_string}</span>
                            <button onclick="deleteRule(${rule.id})" class="bg-red-500 text-white px-2 py-1 rounded">Delete</button>
                        `;
                        rulesList.appendChild(ruleElement);
                    });
                })
                .catch(error => {
                    console.error('Error fetching rules:', error);
                });
        }

        function deleteRule(ruleId) {
            axios.delete(`/delete_rule/${ruleId}`)
                .then(response => {
                    alert('Rule deleted successfully');
                    fetchRules();
                })
                .catch(error => {
                    console.error('Error deleting rule:', error);
                });
        }

        function deleteAllRules() {
            if (confirm('Are you sure you want to delete all rules?')) {
                axios.delete('/delete_all_rules')
                    .then(response => {
                        alert('All rules deleted successfully');
                        fetchRules();
                    })
                    .catch(error => {
                        console.error('Error deleting all rules:', error);
                    });
            }
        }

        // Fetch rules on page load
        fetchRules();
    </script>
</body>
</html>